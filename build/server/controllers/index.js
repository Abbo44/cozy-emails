// Generated by CoffeeScript 1.7.1
var CozyInstance, Mailbox, async;

async = require('async');

Mailbox = require('../models/mailbox');

CozyInstance = require('../models/cozy_instance');

module.exports.main = function(req, res, next) {
  return async.parallel([
    function(cb) {
      return CozyInstance.getLocale(cb);
    }, function(cb) {
      return Mailbox.getAll(cb);
    }
  ], function(err, results) {
    var locale, mailboxes;
    if (err != null) {
      return res.render('index.jade', {
        imports: ""
      });
    } else {
      locale = results[0], mailboxes = results[1];
      return res.render('index.jade', {
        imports: "window.locale = \"" + locale + "\";\nwindow.mailboxes = " + (JSON.stringify(mailboxes)) + ";"
      });
    }
  });
};
