// Generated by CoffeeScript 1.7.1
var Promise, Settings, americano,
  __hasProp = {}.hasOwnProperty;

americano = require('americano-cozy');

Promise = require('bluebird');

module.exports = Settings = americano.getModel('MailsSettings', {
  messagesPerPage: Number,
  displayConversation: Boolean,
  composeInHTML: Boolean,
  messageDisplayHTML: Boolean,
  messageDisplayImages: Boolean,
  lang: String,
  plugins: function(x) {
    return x;
  }
});

Settings.getInstance = function() {
  return Settings.requestPromised('all').get(0).then(function(settings) {
    var defaultSettings, key, value;
    defaultSettings = new Settings({
      messagesPerPage: 5,
      displayConversation: false,
      composeInHTML: true,
      messageDisplayHTML: true,
      messageDisplayImages: false,
      lang: 'en',
      refreshInterval: 5,
      plugins: null
    });
    if (settings == null) {
      return defaultSettings;
    } else {
      for (key in defaultSettings) {
        if (!__hasProp.call(defaultSettings, key)) continue;
        value = defaultSettings[key];
        if (settings[key] == null) {
          settings[key] = value;
        }
      }
      return settings;
    }
  });
};

Promise.promisifyAll(Settings, {
  suffix: 'Promised'
});

Promise.promisifyAll(Settings.prototype, {
  suffix: 'Promised'
});
