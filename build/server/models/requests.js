// Generated by CoffeeScript 1.7.1
var americano;

americano = require('americano');

module.exports = {
  settings: {
    all: americano.defaultRequests.all
  },
  account: {
    all: americano.defaultRequests.all
  },
  contact: {
    all: americano.defaultRequests.all,
    byName: function(doc) {
      var dp, _i, _len, _ref, _results;
      if ((doc.fn != null) && doc.fn.length > 0) {
        emit(doc.fn, doc);
      }
      if (doc.n != null) {
        emit(doc.n.split(';').join(' ').trim(), doc);
      }
      _ref = doc.datapoints;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        dp = _ref[_i];
        if (dp.name === 'email') {
          emit(dp.value, doc);
          _results.push(emit(dp.value.split('@')[1], doc));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    }
  },
  mailbox: {
    treeMap: function(doc) {
      return emit([doc.accountID].concat(doc.tree), null);
    }
  },
  message: {
    byMailboxRequest: {
      reduce: '_count',
      map: function(doc) {
        var boxid, uid, _ref;
        _ref = doc.mailboxIDs;
        for (boxid in _ref) {
          uid = _ref[boxid];
          emit(['uid', boxid, uid], doc.flags);
          emit(['date', boxid, doc.date], doc.flags);
          emit(['subject', boxid, doc.subject], doc.flags);
        }
        return void 0;
      }
    },
    dedupRequest: function(doc) {
      if (doc.messageID) {
        emit([doc.accountID, 'mid', doc.messageID], doc.conversationID);
      }
      if (doc.normSubject) {
        return emit([doc.accountID, 'subject', doc.normSubject], doc.conversationID);
      }
    }
  }
};
